<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css">
</head>

<body style="padding: 0;"> <!-- Cần phải tắt padding do style body vậy -->
    <nav class="nav-bar">
        <p>This site is available in other languages</p>
        <div class="lang-buttons">
            <a href="/index.html" target="_top" title="English" data-lang="en">English</a>
            <a href="/vi/index.html" target="_top" title="Vietnamese" data-lang="vi">Tiếng Việt</a>
            <!-- Future languages can be added here, e.g.: -->
            <!-- <a href="/ja/index.html" target="_top" title="Japanese" data-lang="ja">日本語</a> -->
        </div>
        <p class="lang-redirected" id="lang-redirected">
            Your browser says you don't speak the previous language, so I redirected you here.<br>You can switch back if
            I was wrong.
        </p>
    </nav>
</body>

<script>
    // Hàm gửi chiều cao nội dung lên trang cha
    function sendHeight() {
        const height = document.body.scrollHeight;
        window.parent.postMessage({ type: 'setHeight', height: height }, '*');
    }

    // Lắng nghe lệnh từ trang cha
    window.addEventListener('message', function (event) {
        if (event.data === 'showRedirectMessage') {
            const msgBox = document.getElementById('lang-redirected');
            if (msgBox) {
                msgBox.classList.add('visible');
                // Gửi lại chiều cao sau khi hiện thông báo (đợi animation chạy 1 chút hoặc ngay lập tức)
                // Timeout để đợi animation/DOM update
                setTimeout(sendHeight, 50);
                setTimeout(sendHeight, 500);
            }
        }
    });

    // Gửi chiều cao khi load xong
    window.addEventListener('load', sendHeight);

    // Gửi chiều cao khi resize window
    window.addEventListener('resize', sendHeight);

    // Sử dụng ResizeObserver để theo dõi thay đổi kích thước body
    const resizeObserver = new ResizeObserver(() => {
        sendHeight();
    });
    resizeObserver.observe(document.body);

    // EXPANSIBLE LANGUAGE PATH CHECKER
    // This script automatically fixes broken links in local development
    // It works for ANY language link with a 'data-lang' attribute (except 'en')
    document.querySelectorAll('a[data-lang]').forEach(link => {
        const langCode = link.getAttribute('data-lang');

        // Skip English or root paths
        if (langCode === 'en' || !langCode) return;

        // Path we expect in Production (e.g. /vi/index.html)
        const productionPath = `/${langCode}/index.html`;

        // Check if Production path exists
        fetch(productionPath, { method: 'HEAD' })
            .then(response => {
                if (!response.ok) {
                    // If not found (404), switch to Local Development path
                    // e.g. /translations/vi/index.html
                    console.log(`[Dev Fix] Switching ${langCode} to local path.`);
                    link.href = `/translations/${langCode}/index.html`;
                }
            })
            .catch(() => {
                // Network error (likely local), verify fallback
                link.href = `/translations/${langCode}/index.html`;
            });
    });
</script>

</html>